
@{
    ViewBag.Title = "Index";
}

<h2>Index</h2>

<script>

    var getParam1 = (p) => {

        return $.getJSON('GetParam1?p=' + p);
    }

    var getParam2 = (p) => {

        return $.getJSON('GetParam2?p=' + p);
    }

    var getResource = (p1, p2) => {

        return $.getJSON('GetResource?p1=' + p1 + '&p2=' + p2);
    }

    var initDepGraph = (promiseIn, depGraph) => {

        var promise = promiseIn;

        for (i = 0; i < depGraph.length - 2; i++) {
            promise = promise.then(depGraph[i]);
        }

        promise.done(depGraph[depGraph.length - 2]);
        promise.fail(depGraph[depGraph.length - 1]);
    }

    $(() => {

        var p1 = null;
        var p2 = null;

        var init = [
            (response) => { p1 = response.Value; return getParam2(p1); },
            (response) => { p2 = response.Value; return getResource(p1, p2); },
            (response) => { console.log(response); },
            () => { alert('done'); },
            () => { alert('fail'); }
        ];

        initDepGraph(getParam1(5), init);
    });

</script>

